<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Pipesock</title>
    <script src="d3.min.js" type="text/javascript"></script>
    <style>
      table
      {
        font-family: "Lucida Sans Unicode", "Lucida Grande", Sans-Serif;
        font-size: 12px;
        margin: 45px;
        width:960px;
        text-align: left;
        border-collapse: collapse;
        border: 1px solid #69c;
      }
      table th
      {
        padding: 12px 17px 12px 17px;
        font-weight: normal;
        font-size: 14px;
        color: #039;
        border-bottom: 1px dashed #69c;
        text-align: center;
      }
      table td
      {
        padding: 7px 17px 7px 17px;
        color: #111;
        border-top: 1px solid #dedede;
      }
      table tr:hover td
      {
        color: #339;
        background: #d0dafd;
      }
      </style>
  </head>
  <body>
    <h1>pipesock</h1>
    <table id="output">
      <tr><th>Timestamp</th><th>Message</th></tr>
    </table>
    <script language="javascript" type="text/javascript">

      $(document).ready(function(){
        var wsUri = "ws://"+document.location.host+"/ws";
        var output = $("#output");
        var inputform = $("#inputform");

        function testWebSocket() {
          websocket = new WebSocket(wsUri);
          websocket.onclose = function(evt) { onClose(evt) };
          websocket.onmessage = function(evt) { onMessage(evt) };
          websocket.onerror = function(evt) { onError(evt) };
        };


        function onMessage(evt) {
          if (evt.data == "Welcome") {
            return
            }

          var jsondata = JSON.parse(evt.data);
          var message = "<tr><td>"+new Date(jsondata.Time)+"</td><td>"+jsondata.Message+"</td></tr>"
          writeToScreen(message);
        };

        function onError(evt) { writeToScreen('<tr><td>'+new Date()+'</td><td><span style="color: red;">ERROR</span> ' + evt.reason +'</td></tr>'); }
        function onClose(evt) { console.log(evt); writeToScreen('<tr><td>'+new Date()+'</td><td><span style="color: red;">Close </span> ' + evt.reason +'</td></tr>'); }


        testWebSocket();
      });

      function writeToScreen(message) {
        $("#output").append(message);
      }

    </script>
  </body>
</html>
